<div dir="rtl" style="font-family: 'Vazir', sans-serif; line-height: 1.8;">
---

### فصل نهم: پایگاه داده‌ها

---

## 9.1 معرفی پایگاه داده و MySQL

پایگاه داده‌ها مکان‌هایی هستند که داده‌های ساختار یافته را ذخیره و مدیریت می‌کنند. MySQL یکی از محبوب‌ترین سیستم‌های مدیریت پایگاه داده رابطه‌ای (RDBMS) است که با PHP به خوبی سازگار است.

### 9.1.1 نصب و راه‌اندازی MySQL

برای استفاده از MySQL با PHP، باید MySQL را نصب و راه‌اندازی کنید. در صورتی که از XAMPP یا WAMP استفاده می‌کنید، MySQL به صورت پیش‌فرض نصب شده و فعال است. می‌توانید MySQL را از طریق کنترل پنل XAMPP یا WAMP شروع کنید.

### 9.1.2 اتصال به MySQL

PHP دو روش اصلی برای اتصال به MySQL ارائه می‌دهد: MySQLi و PDO. در اینجا ما از MySQLi استفاده خواهیم کرد.

## 9.2 اتصال به MySQL با MySQLi

### 9.2.1 اتصال به پایگاه داده

برای اتصال به MySQL از تابع `mysqli_connect()` استفاده می‌کنیم:

```php
<?php
$سرور = "localhost";
$کاربر = "root";
$رمزعبور = "";
$پایگاه_داده = "test_db";

$ارتباط = mysqli_connect($سرور, $کاربر, $رمزعبور, $پایگاه_داده);

if (!$ارتباط) {
    die("اتصال به پایگاه داده ناموفق بود: " . mysqli_connect_error());
}
echo "اتصال موفقیت‌آمیز بود!";
?>
```

### 9.2.2 بستن اتصال

پس از اتمام کار با پایگاه داده، باید اتصال را با استفاده از `mysqli_close()` ببندید:

```php
<?php
mysqli_close($ارتباط);
?>
```

## 9.3 عملیات CRUD (ایجاد، خواندن، بروزرسانی، حذف)

CRUD (ایجاد، خواندن، بروزرسانی، حذف) عملیات اصلی است که بر روی پایگاه داده انجام می‌شود.

### 9.3.1 ایجاد داده‌ها (CREATE)

برای افزودن داده به یک جدول از `INSERT INTO` استفاده می‌شود

:

```php
<?php
$sql = "INSERT INTO users (name, email) VALUES ('Ali', 'ali@example.com')";

if (mysqli_query($ارتباط, $sql)) {
    echo "رکورد جدید با موفقیت اضافه شد.";
} else {
    echo "خطا در افزودن رکورد: " . mysqli_error($ارتباط);
}
?>
```

### 9.3.2 خواندن داده‌ها (READ)

برای خواندن داده‌ها از `SELECT` استفاده می‌شود:

```php
<?php
$sql = "SELECT id, name, email FROM users";
$result = mysqli_query($ارتباط, $sql);

if (mysqli_num_rows($result) > 0) {
    while($row = mysqli_fetch_assoc($result)) {
        echo "id: " . $row["id"]. " - نام: " . $row["name"]. " - ایمیل: " . $row["email"]. "<br>";
    }
} else {
    echo "هیچ رکوردی یافت نشد.";
}
?>
```

### 9.3.3 بروزرسانی داده‌ها (UPDATE)

برای بروزرسانی رکوردهای موجود از `UPDATE` استفاده می‌شود:

```php
<?php
$sql = "UPDATE users SET email='newemail@example.com' WHERE id=1";

if (mysqli_query($ارتباط, $sql)) {
    echo "رکورد با موفقیت بروزرسانی شد.";
} else {
    echo "خطا در بروزرسانی رکورد: " . mysqli_error($ارتباط);
}
?>
```

### 9.3.4 حذف داده‌ها (DELETE)

برای حذف رکوردها از `DELETE` استفاده می‌شود:

```php
<?php
$sql = "DELETE FROM users WHERE id=1";

if (mysqli_query($ارتباط, $sql)) {
    echo "رکورد با موفقیت حذف شد.";
} else {
    echo "خطا در حذف رکورد: " . mysqli_error($ارتباط);
}
?>
```

## 9.4 امنیت در برابر SQL Injection

یکی از مهم‌ترین نکات در کار با پایگاه داده‌ها، جلوگیری از حملات SQL Injection است. برای این کار، باید داده‌های ورودی کاربران را پیش از استفاده در کوئری‌ها پاک‌سازی کنید.

### 9.4.1 استفاده از `mysqli_real_escape_string()`

این تابع داده‌های ورودی را پاک‌سازی می‌کند تا از ورود کدهای مخرب به پایگاه داده جلوگیری شود:

```php
<?php
$نام = mysqli_real_escape_string($ارتباط, $_POST['name']);
$sql = "INSERT INTO users (name) VALUES ('$نام')";
?>
```

### 9.4.2 استفاده از Prepared Statements

راه امن‌تر برای جلوگیری از SQL Injection، استفاده از Prepared Statements است:

```php
<?php
$stmt = $ارتباط->prepare("INSERT INTO users (name, email) VALUES (?, ?)");
$stmt->bind_param("ss", $name, $email);

$name = "Ali";
$email = "ali@example.com";
$stmt->execute();

$stmt->close();
?>
```

## 9.5 ORM ها و معرفی به ابزارهایی مثل Eloquent

ORM (Object-Relational Mapping) یک الگوی طراحی است که به شما امکان می‌دهد تا به جای نوشتن کوئری‌های SQL، با استفاده از اشیاء و متدهای شیءگرا به داده‌های پایگاه داده دسترسی پیدا کنید.

### 9.5.1 معرفی Eloquent

Eloquent یک ORM قدرتمند است که در فریم‌ورک Laravel استفاده می‌شود. این ابزار به شما امکان می‌دهد تا به سادگی و با استفاده از متدهای شیءگرا به داده‌های پایگاه داده دسترسی پیدا کنید.

---

## تمرین‌های فصل نهم

1. **اتصال به MySQL**: یک اسکریپت PHP بنویسید که به یک پایگاه داده MySQL متصل شود و پیامی را برای موفقیت یا شکست اتصال نمایش دهد.

2. **ایجاد جدول و درج داده‌ها**: یک اسکریپت بنویسید که یک جدول در پایگاه داده ایجاد کرده و چند رکورد در آن اضافه کند.

3. **خواندن و نمایش داده‌ها**: یک اسکریپت بنویسید که تمام رکوردهای موجود در یک جدول را خوانده و در مرورگر نمایش دهد.

4. **بروزرسانی رکوردها**: یک رکورد مشخص در جدول را با استفاده از `UPDATE` بروزرسانی کنید.

5. **حذف رکوردها**: یک رکورد مشخص را از جدول با استفاده از `DELETE` حذف کنید.

6. **جلوگیری از SQL Injection**: یک اسکریپت بنویسید که داده‌های ورودی کاربر را با استفاده از `mysqli_real_escape_string()` پاک‌سازی کند و سپس آن‌ها را در پایگاه داده ذخیره کند.

---

## خلاصه فصل نهم

در این فصل، با پایگاه داده‌ها و نحوه استفاده از MySQL با PHP آشنا شدید. شما یاد گرفتید که چگونه به MySQL متصل شوید و عملیات CRUD (ایجاد، خواندن، بروزرسانی، حذف) را انجام دهید. همچنین با اصول امنیتی مانند جلوگیری از SQL Injection آشنا شدید. در نهایت، به ORM ها و ابزارهای مرتبط معرفی شدید. کار با پایگاه داده‌ها یکی از مهم‌ترین بخش‌های برنامه‌نویسی کاربردی است و در این فصل، مهارت‌های لازم برای کار با MySQL در PHP را به دست آوردید.

---
</div>
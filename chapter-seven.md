



<div dir="rtl" style="font-family: 'Vazir', sans-serif; line-height: 1.8;">


### فصل هفتم: مدیریت خطاها و استثناها

---

## 7.1 معرفی مدیریت خطاها

خطاها بخشی طبیعی از هر برنامه هستند و مدیریت صحیح آن‌ها می‌تواند به بهبود تجربه کاربری و جلوگیری از مشکلات جدی در برنامه کمک کند. در PHP، مدیریت خطاها می‌تواند به صورت دستی یا با استفاده از استثناها (Exceptions) انجام شود.

### 7.1.1 انواع خطاها در PHP

در PHP چندین نوع خطا وجود دارد که هر یک نمایانگر نوع خاصی از مشکل هستند:

- **خطاهای پارسینگ (Parse Errors)**: زمانی رخ می‌دهند که PHP نتواند کد شما را تجزیه کند، معمولاً به دلیل خطای سینتکسی.
- **خطاهای زمان اجرا (Runtime Errors)**: در زمان اجرای کد رخ می‌دهند، معمولاً به دلیل مشکلات منطقی در کد.
- **خطاهای منطقی (Logical Errors)**: خطاهایی که کد شما به درستی کار می‌کند، اما نتیجه‌ای که می‌خواهید به دست نمی‌آید.

### 7.1.2 مدیریت خطاها با `error_reporting`

PHP به شما امکان می‌دهد تا سطح گزارش‌دهی خطاها را تنظیم کنید. برای این کار از تابع `error_reporting()` استفاده می‌شود:

```php
<?php
error_reporting(E_ALL); // گزارش همه خطاها
error_reporting(E_ERROR | E_WARNING); // فقط گزارش خطاها و هشدارها
?>
```

### 7.1.3 تنظیمات `display_errors`

برای نمایش خطاها در مرورگر، می‌توانید از تنظیمات `display_errors` استفاده کنید:

```php
<?php
ini_set('display_errors', 1);
ini_set('display_startup_errors', 1);
error_reporting(E_ALL);
?>
```

## 7.2 مدیریت استثناها (Exceptions)

استثناها در PHP به شما امکان می‌دهند تا خطاها را به صورت ساخت‌یافته‌تری مدیریت کنید. با استفاده از بلوک‌های `try...catch` می‌توانید خطاهای احتمالی را شناسایی و مدیریت کنید.

### 7.2.1 بلوک `try...catch`

بلوک `try` شامل کدی است که ممکن است خطا ایجاد کند و بلوک `catch` شامل کدی است که خطا را مدیریت می‌کند:

```php
<?php
try {
    $عدد = 10 / 0;
} catch (Exception $e) {
    echo "خطا رخ داد: " . $e->getMessage();
}
?>
```

### 7.2.2 ایجاد استثناهای سفارشی

PHP به شما امکان می‌دهد تا استثناهای سفارشی خود را ایجاد کنید. برای این کار باید از کلاس `Exception` ارث‌بری کنید:

```php
<?php
class خطای_سفارشی extends Exception {}

try {
    throw new خطای_سفارشی("این یک خطای سفارشی است.");
} catch (خطای_سفارشی $e) {
    echo $e->getMessage();
}
?>
```

## 7

.3 متدهای مفید کلاس Exception

کلاس `Exception` چندین متد مفید دارد که می‌توانید از آن‌ها برای دسترسی به جزئیات بیشتر درباره خطا استفاده کنید:

- **`getMessage()`**: پیام خطا را برمی‌گرداند.
- **`getCode()`**: کد خطا را برمی‌گرداند.
- **`getFile()`**: فایلی که خطا در آن رخ داده است را برمی‌گرداند.
- **`getLine()`**: شماره خطی که خطا در آن رخ داده است را برمی‌گرداند.
- **`getTraceAsString()`**: اطلاعاتی درباره ردیابی خطا برمی‌گرداند.

```php
<?php
try {
    throw new Exception("خطای تستی", 404);
} catch (Exception $e) {
    echo "پیام: " . $e->getMessage();
    echo "کد: " . $e->getCode();
    echo "فایل: " . $e->getFile();
    echo "خط: " . $e->getLine();
}
?>
```

## 7.4 مدیریت خطاها و استثناها با `set_error_handler` و `set_exception_handler`

PHP به شما امکان می‌دهد تا مدیریت‌کننده‌های سفارشی برای خطاها و استثناها تعریف کنید:

### 7.4.1 مدیریت‌کننده خطا با `set_error_handler`

```php
<?php
function مدیریت_خطا($شماره_خطا, $پیام_خطا, $فایل_خطا, $خط) {
    echo "خطا [$شماره_خطا] در فایل $فایل_خطا در خط $خط: $پیام_خطا";
}

set_error_handler("مدیریت_خطا");
echo $test; // ایجاد خطا
?>
```

### 7.4.2 مدیریت‌کننده استثنا با `set_exception_handler`

```php
<?php
function مدیریت_استثنا($استثنا) {
    echo "استثنا: " . $استثنا->getMessage();
}

set_exception_handler("مدیریت_استثنا");
throw new Exception("این یک استثنا است.");
?>
```

## 7.5 پاکسازی (Finally)

PHP از بلوک `finally` پشتیبانی می‌کند که همیشه اجرا می‌شود، چه استثنایی رخ دهد چه ندهد:

```php
<?php
try {
    // کد ممکن است استثنا تولید کند
} catch (Exception $e) {
    // مدیریت استثنا
} finally {
    echo "این کد همیشه اجرا می‌شود.";
}
?>
```

---

## تمرین‌های فصل هفتم

1. **مدیریت خطاهای ساده**: یک اسکریپت بنویسید که شامل یک خطای زمان اجرا باشد و سپس با استفاده از `error_reporting` و `ini_set` خطا را گزارش و نمایش دهید.

2. **استفاده از `try...catch`**: یک اسکریپت بنویسید که در آن تلاش می‌شود تا یک عدد را بر صفر تقسیم کنید و این خطا را با استفاده از `try...catch` مدیریت کنید.

3. **ایجاد استثناهای سفارشی**: یک کلاس استثنا سفارشی ایجاد کنید و سپس یک اسکریپت بنویسید که این استثنا را تولید و مدیریت کند.

4. **مدیریت خطاها با `set_error_handler`**: یک مدیریت‌کننده خطای سفارشی ایجاد کنید که وقتی خطایی رخ می‌دهد، پیامی سفارشی نمایش داده شود.

5. **استفاده از `finally`**: یک اسکریپت بنویسید که در آن یک استثنا تولید شده و در بلوک `finally` یک پیام ساده نمایش داده شود.

---

## خلاصه فصل هفتم

در این فصل، با مدیریت خطاها و استثناها در PHP آشنا شدید. شما یاد گرفتید که چگونه خطاها را شناسایی، گزارش و مدیریت کنید. همچنین با استفاده از بلوک‌های `try...catch` و ایجاد استثناهای سفارشی، خطاها را به صورت ساخت‌یافته‌تری مدیریت کردید. در نهایت، با مدیریت‌کننده‌های سفارشی خطاها و استثناها و بلوک `finally` آشنا شدید. مدیریت خطاها و استثناها به شما کمک می‌کند تا برنامه‌هایی پایدارتر و قابل اطمینان‌تر ایجاد کنید و در این فصل، مهارت‌های لازم برای این کار را به دست آوردید.

---
</div>
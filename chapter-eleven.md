<div dir="rtl" style="font-family: 'Vazir', sans-serif; line-height: 1.8;">
---

### فصل یازدهم: امنیت در PHP

---

## 11.1 اهمیت امنیت در PHP

امنیت یکی از مهم‌ترین جوانب توسعه وب است. بدون امنیت مناسب، برنامه‌های وب به راحتی می‌توانند مورد حمله قرار گیرند و داده‌های حساس به خطر بیفتند. در این فصل، با برخی از بهترین شیوه‌های امنیتی در PHP آشنا می‌شوید.

## 11.2 بهترین شیوه‌های امنیتی

### 11.2.1 استفاده از Prepared Statements

یکی از رایج‌ترین حملات، SQL Injection است. برای جلوگیری از این نوع حمله، باید از Prepared Statements استفاده کنید:

```php
<?php
$stmt = $ارتباط->prepare("INSERT INTO users (name, email) VALUES (?, ?)");
$stmt->bind_param("ss", $name, $email);
$stmt->execute();
?>
```

### 11.2.2 پاک‌سازی ورودی‌ها

داده‌های ورودی کاربران باید پیش از استفاده پاک‌سازی شوند تا از ورود کدهای مخرب جلوگیری شود. از توابعی مانند `htmlspecialchars()`، `strip_tags()` و `mysqli_real_escape_string()` استفاده کنید.

### 11.2.3 استفاده از رمزنگاری

برای محافظت از داده‌های حساس مانند رمزهای عبور، باید از رمزنگاری استفاده کنید. PHP تابعی به نام `password_hash()` دارد که برای رمزنگاری رمزهای عبور استفاده می‌شود:

```php
<?php
$hashedPassword = password_hash($password, PASSWORD_DEFAULT);
?>
```

### 11.2.4 محافظت در برابر CSRF

همان‌طور که در فصل قبل توضیح داده شد، برای جلوگیری از حملات CSRF، از توکن‌های CSRF استفاده کنید.

### 11.2.5 محافظت در برابر XSS

برای جلوگیری از حملات XSS، داده‌های کاربر را پیش از نمایش در صفحه پاک‌سازی کنید.

## 11.3 مدیریت فایل‌های حساس

### 11.3.1 محافظت از فایل‌های حساس

فایل‌های حساس مانند فایل‌های پیکربندی که شامل اطلاعات پایگاه داده هستند، نباید در دسترس عمومی قرار گیرند. برای محافظت از این فایل‌ها، می‌توانید از `.htaccess` برای محدود کردن دسترسی استفاده کنید.

### 11.3.2 استفاده از HTTPS

استفاده از HTTPS برای رمزنگاری ارتباطات بین مرورگر و سرور ضروری است. این کار از دزدیده شدن اطلاعات حساس توسط مهاجمان جلوگیری می‌کند.

### 11.3.3 مدیریت خطاها

خطاها می‌توانند اطلاعات حساس درباره ساختار برنامه شما را فاش کنند. مطمئن شوید که نمایش خطاها را در محیط تولید غیرفعال کرده‌اید:

```php
<?php
ini_set('display_errors', 0);
error_reporting(0);
?>
```

## 11.4 مدیریت نشست‌ها و کوکی‌ها

### 11.4.1 امن‌سازی کوکی‌ها

برای جلوگیری از دسترسی غیرمجاز به کوکی‌ها، می‌توانید از ویژگی‌های امنیتی مانند `HttpOnly` و `Secure` استفاده کنید:

```php
<?php
setcookie("username", "Ali", time() + (86400 * 30), "/", "", true, true);
?>
```

### 11.4.2 مدیریت طول عمر نشست‌ها

طول عمر نشست‌ها باید مدیریت شود تا خطر ربایش نشست‌ها کاهش یابد. می‌توانید این کار را با تنظیم مقادیر در فایل `php.ini` انجام دهید:

```ini
session.gc_maxlifetime = 1440
session.cookie_lifetime = 0
```

## 11.5 بررسی و به‌روزرسانی مداوم

امنیت یک فرآیند مداوم است و باید به طور مداوم برنامه‌های خود را برای آسیب‌پذیری‌ها بررسی و به‌روزرسانی کنید.

### 11.5.1 استفاده از ابزارهای تست امنیتی

ابزارهای مختلفی برای تست امنیت برنامه‌های وب وجود دارد که می‌توانید از آن‌ها برای شناسایی و رفع آسیب‌پذیری‌ها استفاده کنید.

### 11.5.2 به‌روزرسانی نرم‌افزارها

همیشه مطمئن شوید که نسخه‌های PHP و سایر نرم‌افزارهای مرتبط با برنامه‌های شما به‌روز هستند تا از بهره‌برداری از آسیب‌پذیری‌های شناخته‌شده جلوگیری کنید.

---

## تمرین‌های فصل یازدهم

1. **استفاده از Prepared Statements**: یک اسکریپت PHP بنویسید که از Prepared Statements برای جلوگیری از SQL Injection استفاده کند.

2. **پاک‌سازی ورودی‌ها**: داده‌های ورودی کاربر را با استفاده از `htmlspecialchars()` و `mysqli_real_escape_string()` پاک‌سازی کنید و سپس آن‌ها را در پایگاه داده ذخیره کنید.

3. **رمزنگاری رمز عبور**: یک رمز عبور را با استفاده از `password_hash()` رمزنگاری کنید و سپس آن را در پایگاه داده ذخیره کنید.

4. **ایمن‌سازی کوکی‌ها**: یک کوکی با ویژگی‌های `HttpOnly` و `Secure` تنظیم کنید و سپس آن را در یک اسکریپت PHP استفاده کنید.

5. **مدیریت خطاها**: مطمئن شوید که نمایش خطاها در محیط تولید غیرفعال است و خطاها را در یک فایل لاگ ثبت کنید.

6. **بررسی امنیتی**: از یک ابزار تست امنیتی برای بررسی آسیب

‌پذیری‌های اسکریپت PHP خود استفاده کنید و گزارش‌ها را تحلیل کنید.

---

## خلاصه فصل یازدهم

در این فصل، با اصول و بهترین شیوه‌های امنیتی در PHP آشنا شدید. شما یاد گرفتید که چگونه با استفاده از Prepared Statements از حملات SQL Injection جلوگیری کنید و داده‌های ورودی کاربران را پاک‌سازی کنید. همچنین با رمزنگاری رمزهای عبور، محافظت در برابر CSRF و XSS و مدیریت نشست‌ها و کوکی‌ها آشنا شدید. امنیت یک جنبه حیاتی از توسعه وب است و در این فصل، مهارت‌های لازم برای ایجاد برنامه‌های امن‌تر را به دست آوردید.

---
</div>
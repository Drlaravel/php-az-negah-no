<div dir="rtl" style="font-family: 'Vazir', sans-serif; line-height: 1.8;">

### **فصل هشتم: کار با فایل‌ها در PHP**

---

### **8.1 مقدمه‌ای بر کار با فایل‌ها**

کار با فایل‌ها یکی از وظایف اساسی در بسیاری از برنامه‌های وب و کاربردی است. فایل‌ها به برنامه‌ها این امکان را می‌دهند که داده‌ها را به‌طور موقت یا دائم ذخیره، بازیابی و پردازش کنند. از جمله کاربردهای رایج کار با فایل‌ها می‌توان به ذخیره داده‌های کاربر، لاگ‌برداری، خواندن و نوشتن فایل‌های پیکربندی، ایجاد گزارش‌ها، مدیریت فایل‌های CSV و حتی کار با فایل‌های باینری مانند تصاویر و اسناد اشاره کرد. 

در PHP، می‌توان از مجموعه‌ای از توابع داخلی برای مدیریت فایل‌ها استفاده کرد. این توابع به شما این امکان را می‌دهند که فایل‌ها را باز کرده، بخوانید، بنویسید، حذف کنید، بررسی کنید که آیا یک فایل وجود دارد یا خیر، و بسیاری عملیات دیگر.

### **8.2 باز کردن و بستن فایل‌ها**

در PHP، برای انجام هرگونه عملیات بر روی یک فایل، ابتدا باید آن فایل را باز کنید. این کار با استفاده از تابع `fopen()` انجام می‌شود. این تابع دو پارامتر اصلی می‌پذیرد: مسیر فایل و حالت باز کردن فایل. حالت‌های باز کردن فایل تعیین می‌کنند که فایل چگونه باز شود - برای خواندن، نوشتن، یا هر دو.

#### **8.2.1 حالت‌های باز کردن فایل**

در `fopen()`، حالت‌های مختلفی برای باز کردن فایل وجود دارد:

- **`r`**: باز کردن فایل برای خواندن. این حالت فایل را به صورت فقط خواندنی باز می‌کند و مکان اشاره‌گر فایل را در ابتدای فایل قرار می‌دهد. اگر فایل وجود نداشته باشد، یک خطا ایجاد می‌شود.
- **`w`**: باز کردن فایل برای نوشتن. این حالت فایل را به صورت نوشتنی باز می‌کند و محتوای فایل را پاک می‌کند. اگر فایل وجود نداشته باشد، یک فایل جدید ایجاد می‌کند.
- **`a`**: باز کردن فایل برای افزودن داده. این حالت فایل را به صورت نوشتنی باز می‌کند و مکان اشاره‌گر فایل را در انتهای فایل قرار می‌دهد. اگر فایل وجود نداشته باشد، یک فایل جدید ایجاد می‌کند.
- **`x`**: باز کردن فایل برای نوشتن. این حالت مانند `w` است، اما اگر فایل وجود داشته باشد، یک خطا ایجاد می‌کند.
- **`r+`**: باز کردن فایل برای خواندن و نوشتن.
- **`w+`**: باز کردن فایل برای خواندن و نوشتن. اگر فایل وجود داشته باشد، محتوا پاک می‌شود.
- **`a+`**: باز کردن فایل برای خواندن و نوشتن. اگر فایل وجود نداشته باشد، یک فایل جدید ایجاد می‌کند. مکان اشاره‌گر فایل در انتهای فایل قرار می‌گیرد.

### **8.3 خواندن از فایل‌ها**

PHP مجموعه‌ای از توابع برای خواندن محتویات فایل‌ها ارائه می‌دهد. هر کدام از این توابع برای موقعیت‌های خاصی مفید هستند.

#### **8.3.1 خواندن با استفاده از `fread()`**

تابع `fread()` برای خواندن محتویات فایل به اندازه بایت‌های مشخص‌شده استفاده می‌شود. این تابع نیاز به اشاره‌گر فایل (که از `fopen()` به دست آمده) و تعداد بایت‌هایی که باید خوانده شوند دارد.

**مثال: خواندن تمام محتویات فایل:**

```php
<?php
$file = fopen("example.txt", "r"); // باز کردن فایل برای خواندن
if ($file) {
    $content = fread($file, filesize("example.txt")); // خواندن تمام محتویات فایل
    echo $content; // نمایش محتویات فایل
    fclose($file); // بستن فایل
} else {
    echo "Error opening file.";
}
?>
```

#### **8.3.2 خواندن خط به خط با `fgets()`**

تابع `fgets()` هر بار یک خط را از فایل می‌خواند. این روش برای خواندن فایل‌های متنی که به صورت خط به خط پردازش می‌شوند، مناسب است.

**مثال: خواندن خط به خط از یک فایل:**

```php
<?php
$file = fopen("example.txt", "r"); // باز کردن فایل برای خواندن
if ($file) {
    while (!feof($file)) { // تا زمانی که به انتهای فایل نرسیده‌ایم
        $line = fgets($file); // خواندن یک خط از فایل
        echo $line . "<br>"; // نمایش خط خوانده‌شده
    }
    fclose($file); // بستن فایل
} else {
    echo "Error opening file.";
}
?>
```

#### **8.3.3 خواندن کل فایل با `file_get_contents()`**

تابع `file_get_contents()` برای خواندن کل محتویات یک فایل به صورت ساده‌تر استفاده می‌شود. این تابع نیازی به باز کردن یا بستن فایل ندارد و تمام محتویات فایل را به صورت یک رشته برمی‌گرداند.

**مثال:**

```php
<?php
$content = file_get_contents("example.txt"); // خواندن تمام محتویات فایل
echo $content; // نمایش محتویات
?>
```

### **8.4 نوشتن در فایل‌ها**



---
#### **8.4.1 نوشتن در فایل با استفاده از `fwrite()`**

تابع `fwrite()` برای نوشتن داده‌ها به فایل استفاده می‌شود. این تابع به دو پارامتر نیاز دارد: اشاره‌گر فایل (که از `fopen()` به دست آمده) و داده‌هایی که باید نوشته شوند. اگر فایل در حالت `w` یا `w+` باز شده باشد، محتوای فایل پاک می‌شود و داده‌های جدید جایگزین می‌شوند.

**مثال: نوشتن در یک فایل:**

```php
<?php
$file = fopen("example.txt", "w"); // باز کردن فایل برای نوشتن
if ($file) {
    fwrite($file, "Hello, World!"); // نوشتن داده‌ها در فایل
    fwrite($file, "\nThis is a new line."); // افزودن خط جدید به فایل
    fclose($file); // بستن فایل
    echo "Data written to file successfully.";
} else {
    echo "Error opening file for writing.";
}
?>
```

#### **8.4.2 نوشتن در فایل با `file_put_contents()`**

تابع `file_put_contents()` یک روش ساده‌تر برای نوشتن داده‌ها در فایل فراهم می‌کند. این تابع به صورت داخلی فایل را باز کرده، داده‌ها را نوشته و سپس فایل را می‌بندد. اگر فایل وجود نداشته باشد، ایجاد می‌شود.

**مثال: نوشتن و جایگزینی محتوای فایل:**

```php
<?php
file_put_contents("example.txt", "Hello, World!"); // نوشتن داده‌ها در فایل
echo "Data written to file successfully.";
?>
```

می‌توان از حالت `FILE_APPEND` برای اضافه کردن داده‌ها به انتهای فایل استفاده کرد بدون اینکه محتوای قبلی پاک شود:

```php
<?php
file_put_contents("example.txt", "\nAppending this line.", FILE_APPEND); // افزودن داده‌ها به انتهای فایل
?>
```

### **8.5 قفل کردن فایل‌ها برای جلوگیری از مشکلات هم‌زمانی**

در برنامه‌هایی که چندین کاربر یا فرآیند به طور هم‌زمان به یک فایل دسترسی دارند، قفل کردن فایل‌ها ضروری است. قفل فایل‌ها برای جلوگیری از مشکلات هم‌زمانی (race conditions) استفاده می‌شود.

#### **8.5.1 استفاده از `flock()` برای قفل کردن فایل‌ها**

تابع `flock()` برای قفل کردن و باز کردن قفل فایل‌ها استفاده می‌شود. این تابع برای جلوگیری از دسترسی هم‌زمان به یک فایل خاص توسط چندین فرآیند کاربرد دارد.

**مثال: قفل کردن یک فایل برای نوشتن:**

```php
<?php
$file = fopen("example.txt", "a+"); // باز کردن فایل برای خواندن و نوشتن
if ($file) {
    if (flock($file, LOCK_EX)) { // قفل انحصاری فایل برای نوشتن
        fwrite($file, "\nAdding this line exclusively."); // نوشتن به فایل
        flock($file, LOCK_UN); // باز کردن قفل فایل
    } else {
        echo "Could not lock the file for writing.";
    }
    fclose($file); // بستن فایل
} else {
    echo "Error opening file.";
}
?>
```

### **8.6 بررسی و حذف فایل‌ها**

بررسی وجود یک فایل یا حذف آن از جمله عملیاتی است که ممکن است در بسیاری از برنامه‌ها نیاز باشد.

#### **8.6.1 بررسی وجود فایل با `file_exists()`**

تابع `file_exists()` بررسی می‌کند که آیا یک فایل یا دایرکتوری خاص وجود دارد یا خیر.

**مثال:**

```php
<?php
if (file_exists("example.txt")) {
    echo "File exists.";
} else {
    echo "File does not exist.";
}
?>
```

#### **8.6.2 حذف فایل با `unlink()`**

تابع `unlink()` برای حذف یک فایل از سیستم استفاده می‌شود. این تابع فقط فایل‌های معمولی را حذف می‌کند و برای حذف پوشه‌ها باید از `rmdir()` استفاده شود.

**مثال:**

```php
<?php
if (file_exists("example.txt")) {
    unlink("example.txt"); // حذف فایل
    echo "File deleted.";
} else {
    echo "File does not exist.";
}
?>
```

### **8.7 کار با پوشه‌ها و دایرکتوری‌ها**

علاوه بر فایل‌ها، PHP به شما این امکان را می‌دهد که با پوشه‌ها نیز کار کنید. می‌توانید پوشه‌ها را ایجاد، حذف و پیمایش کنید و محتویات آن‌ها را لیست کنید.

#### **8.7.1 ایجاد یک پوشه جدید با `mkdir()`**

تابع `mkdir()` برای ایجاد یک پوشه جدید استفاده می‌شود. همچنین می‌توانید دسترسی‌های خاصی را برای پوشه جدید تعریف کنید.

**مثال: ایجاد یک پوشه جدید:**

```php
<?php
if (!file_exists("newFolder")) {
    mkdir("newFolder", 0777, true); // ایجاد پوشه جدید با دسترسی کامل
    echo "Folder created successfully.";
} else {
    echo "Folder already exists.";
}
?>
```

#### **8.7.2 حذف پوشه با `rmdir()`**

تابع `rmdir()` برای حذف یک پوشه استفاده می‌شود. این تابع تنها زمانی کار می‌کند که پوشه خالی باشد.

**مثال: حذف یک پوشه:**

```php
<?php
if (file_exists("newFolder")) {
    rmdir("newFolder"); // حذف پوشه
    echo "Folder deleted.";
} else {
    echo "Folder does not exist.";
}
?>
```

#### **8.7.3 لیست کردن محتویات پوشه با `scandir()`**

تابع `scandir()` برای لیست کردن محتویات یک پوشه استفاده می‌شود. این تابع یک آرایه شامل نام تمام فایل‌ها و پوشه‌ها در پوشه مشخص‌شده برمی‌گرداند.

**مثال: لیست کردن محتویات دایرکتوری:**

```php
<?php
$files = scandir("."); // لیست کردن تمام فایل‌ها و پوشه‌ها در دایرکتوری جاری
print_r($files); // نمایش لیست
?>
```

### **8.8 مدیریت فایل‌های CSV**

فایل‌های CSV (Comma-Separated Values) یکی از رایج‌ترین فرمت‌ها برای ذخیره و تبادل داده‌ها هستند. PHP توابع متعددی برای کار با فایل‌های CSV فراهم می‌کند.

#### **8.8.1 خواندن فایل CSV با `fgetcsv()`**

تابع `fgetcsv()` برای خواندن یک خط از فایل CSV و تبدیل آن به آرایه‌ای از مقادیر استفاده می‌شود.

**مثال: خواندن فایل CSV و نمایش محتویات:**

```php
<?php
$file = fopen("data.csv", "r"); // باز کردن فایل CSV برای خواندن
if ($file) {
    while (($data = fgetcsv($file, 1000, ",")) !== FALSE) { // خواندن خط به خط از CSV
        print_r($data); // نمایش هر خط به صورت آرایه
        echo "<br>";
    }
    fclose($file); // بستن فایل
} else {
    echo "Error opening file.";
}
?>
```

#### **8.8.2 نوشتن در فایل CSV با `fputcsv()`**

تابع `fputcsv()` یک آرایه را به یک خط در فایل CSV تبدیل کرده و آن را می‌نویسد.

**مثال: نوشتن داده‌ها در فایل CSV:**

```php
<?php
$file = fopen("data.csv", "a+"); // باز کردن فایل CSV برای نوشتن
if ($file) {
    $data = array("John Doe", "johndoe@example.com", "35"); // داده‌های جدید برای نوشتن در CSV
    fputcsv($file, $data); // نوشتن داده‌ها در CSV
    fclose($file); // بستن فایل
    echo "Data written to CSV file successfully.";
} else {
    echo "Error opening file for writing.";
}
?>
```

### **8.9 کار با فایل‌های باینری**

فایل‌های باینری مانند تصاویر، ویدئوها، و فایل‌های اجرایی نیاز به مدیریت خاصی دارند. توابع `fread()` و `fwrite()` نیز برای خواندن و نوشتن فایل‌های باینری استفاده می‌شوند.

#### **8.9.1 خواندن و نوشتن فایل‌های باینری**

برای کار با فایل‌های باینری باید فایل را با حالت `b` باز کنید:

```php
<?php
// خواندن فایل باینری
$file = fopen("image.jpg", "rb"); // باز کردن فایل به صورت باینری
$content = fread($file, filesize("image.jpg")); // خواندن محتویات فایل
fclose($file);

// نوشتن فایل باینری
$newFile = fopen("copy_image.jpg", "wb"); // باز کردن فایل به صورت باینری برای نوشتن
fwrite($newFile, $content); // نوشتن محتویات
fclose($newFile);
?>
```

### **8.10 نکات بهینه‌سازی و امنیت در کار با فایل‌ها**

هنگام کار با فایل‌ها، باید به نکات امنیتی و بهینه‌سازی توجه ویژه‌ای داشت:

1. **استفاده از توابع مناسب برای جلوگیری از مشکلات امنیتی:** همیشه ورودی‌های کاربر را قبل از استفاده برای باز کردن فایل‌ها پاکسازی کنید.
2.

 **بستن فایل‌ها پس از استفاده:** عدم بستن فایل‌ها می‌تواند منجر به نشت حافظه شود.
3. **استفاده از قفل‌ها برای جلوگیری از مشکلات هم‌زمانی:** در برنامه‌هایی که به طور هم‌زمان به فایل‌ها دسترسی دارند، از `flock()` استفاده کنید.
4. **محدود کردن دسترسی به فایل‌ها:** اطمینان حاصل کنید که دسترسی‌های فایل‌ها به درستی تنظیم شده‌اند تا از دسترسی غیرمجاز جلوگیری شود.

### **تمرین‌های فصل هشتم**

1. **خواندن یک فایل و نمایش محتوا:** فایلی به نام `sample.txt` ایجاد کنید و محتوای آن را با استفاده از `fread()` بخوانید و نمایش دهید.
2. **نوشتن در یک فایل:** برنامه‌ای بنویسید که یک فایل جدید ایجاد کرده و متنی را در آن بنویسد.
3. **خواندن خط به خط از یک فایل:** برنامه‌ای بنویسید که یک فایل را خط به خط بخواند و محتوا را نمایش دهد.
4. **حذف یک فایل:** بررسی کنید که آیا یک فایل خاص وجود دارد، اگر وجود داشت آن را حذف کنید.
5. **مدیریت فایل‌های CSV:** برنامه‌ای بنویسید که داده‌ها را از یک فایل CSV بخواند و سپس آن‌ها را در یک آرایه ذخیره کند.
6. **ایجاد و حذف پوشه‌ها:** برنامه‌ای بنویسید که یک پوشه جدید ایجاد کرده و سپس آن را حذف کند.
7. **نوشتن به فایل باینری:** یک برنامه بنویسید که یک تصویر را خوانده و یک کپی از آن ایجاد کند.

### **خلاصه فصل هشتم**

در این فصل، با مفاهیم اصلی و پیشرفته کار با فایل‌ها در PHP آشنا شدید. یاد گرفتید که چگونه فایل‌ها را باز کرده، بخوانید، بنویسید، ایجاد و حذف کنید. همچنین با کار با پوشه‌ها، فایل‌های CSV، فایل‌های باینری و نکات امنیتی و بهینه‌سازی آشنا شدید. این مهارت‌ها به شما کمک می‌کنند تا داده‌های خود را به صورت پایدار و ایمن در فایل‌ها ذخیره کرده و آن‌ها را بهینه مدیریت کنید.

---

</div>


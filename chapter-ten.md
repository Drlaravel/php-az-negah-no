<div dir="rtl" style="font-family: 'Vazir', sans-serif; line-height: 1.8;">

---
در فصل دهم، به مبحث تعامل با فرم‌ها و وب در PHP خواهیم پرداخت. فرم‌ها نقش حیاتی در برنامه‌های وب ایفا می‌کنند زیرا ورودی‌های کاربر را جمع‌آوری می‌کنند و آن‌ها را به سرور ارسال می‌کنند. در این فصل، به نحوه ساخت فرم‌های HTML، روش‌های ارسال داده‌ها به PHP، پردازش و اعتبارسنجی داده‌های فرم، مدیریت نشست‌ها (Sessions) و کوکی‌ها (Cookies) برای حفظ اطلاعات کاربر و بهترین شیوه‌های امنیتی در تعامل با فرم‌ها پرداخته خواهد شد.

### **فصل دهم: تعامل با فرم‌ها و وب در PHP**

---

### **10.1 مقدمه‌ای بر تعامل با فرم‌ها در PHP**

فرم‌ها در صفحات وب، واسطی برای جمع‌آوری و ارسال داده‌های کاربر به سرور هستند. در PHP، می‌توان داده‌های ارسال‌شده از طریق فرم‌ها را با استفاده از متدهای `GET` و `POST` دریافت و پردازش کرد. PHP همچنین ابزارهایی برای اعتبارسنجی داده‌های ورودی، مدیریت نشست‌ها (sessions) و کوکی‌ها (cookies)، و محافظت در برابر حملات مختلف از جمله حملات تزریق (injection attacks) ارائه می‌دهد.

### **10.2 روش‌های ارسال داده‌ها در فرم‌ها**

دو روش اصلی برای ارسال داده‌ها از فرم به سرور وجود دارد: `GET` و `POST`. هر کدام از این متدها کاربردها و محدودیت‌های خاص خود را دارند.

#### **10.2.1 متد `GET`**

در متد `GET`، داده‌های فرم به URL اضافه می‌شوند و برای مرورگر و سرور قابل مشاهده هستند. این روش برای ارسال داده‌های کوچک و غیر حساس مناسب است. همچنین، `GET` اجازه می‌دهد که URL‌ها ذخیره شوند و به راحتی به اشتراک گذاشته شوند.

**مثال: فرم با متد `GET`:**

```html
<form action="process_get.php" method="get">
    <label for="name">Name:</label>
    <input type="text" id="name" name="name"><br><br>
    <label for="email">Email:</label>
    <input type="email" id="email" name="email"><br><br>
    <input type="submit" value="Submit">
</form>
```

#### **10.2.2 متد `POST`**

در متد `POST`، داده‌ها به عنوان بدنه درخواست (request body) ارسال می‌شوند و در URL قابل مشاهده نیستند. این روش برای ارسال داده‌های حساس مانند رمزهای عبور و اطلاعات شخصی مناسب است. همچنین، `POST` محدودیتی برای حجم داده‌های ارسال‌شده ندارد.

**مثال: فرم با متد `POST`:**

```html
<form action="process_post.php" method="post">
    <label for="username">Username:</label>
    <input type="text" id="username" name="username"><br><br>
    <label for="password">Password:</label>
    <input type="password" id="password" name="password"><br><br>
    <input type="submit" value="Login">
</form>
```

### **10.3 پردازش داده‌های فرم در PHP**

پس از ارسال داده‌ها از طریق فرم به سرور، PHP می‌تواند این داده‌ها را با استفاده از آرایه‌های فوق‌العاده (superglobals) `$_GET` و `$_POST` دریافت و پردازش کند.

#### **10.3.1 پردازش داده‌های ارسال‌شده با `GET`**

**مثال: دریافت و نمایش داده‌های ارسال‌شده با `GET`:**

```php
<?php
if (isset($_GET['name']) && isset($_GET['email'])) {
    $name = $_GET['name'];
    $email = $_GET['email'];
    echo "Name: " . htmlspecialchars($name) . "<br>Email: " . htmlspecialchars($email);
} else {
    echo "No data received.";
}
?>
```

در این مثال، داده‌های ورودی کاربر با استفاده از `$_GET` دریافت و سپس با استفاده از تابع `htmlspecialchars()` برای جلوگیری از حملات XSS (Cross-Site Scripting) پاکسازی شده‌اند.

#### **10.3.2 پردازش داده‌های ارسال‌شده با `POST`**

**مثال: دریافت و پردازش داده‌های ارسال‌شده با `POST`:**

```php
<?php
if ($_SERVER["REQUEST_METHOD"] == "POST") {
    $username = $_POST['username'];
    $password = $_POST['password'];
    
    echo "Username: " . htmlspecialchars($username) . "<br>Password: " . htmlspecialchars($password);
} else {
    echo "No data received.";
}
?>
```

### **10.4 اعتبارسنجی داده‌های ورودی فرم**

اعتبارسنجی داده‌های ورودی فرم قبل از پردازش یا ذخیره‌سازی آن‌ها برای جلوگیری از حملات و اشتباهات ضروری است. PHP توابع و روش‌های متعددی برای اعتبارسنجی داده‌ها ارائه می‌دهد.

#### **10.4.1 اعتبارسنجی داده‌های متنی**

برای اعتبارسنجی داده‌های متنی مانند نام و آدرس ایمیل، می‌توان از توابع `filter_var()` و `preg_match()` استفاده کرد.

**مثال: اعتبارسنجی آدرس ایمیل:**

```php
<?php
$email = $_POST['email'];

if (filter_var($email, FILTER_VALIDATE_EMAIL)) {
    echo "Valid email address.";
} else {
    echo "Invalid email address.";
}
?>
```

#### **10.4.2 اعتبارسنجی داده‌های عددی**

برای اطمینان از اینکه داده‌ها عددی هستند، می‌توان از توابع `is_numeric()` و `filter_var()` استفاده کرد.

**مثال: اعتبارسنجی شماره تماس:**

```php
<?php
$phone = $_POST['phone'];

if (is_numeric($phone)) {
    echo "Valid phone number.";
} else {
    echo "Invalid phone number.";
}
?>
```

### **10.5 استفاده از نشست‌ها (Sessions) در PHP**

نشست‌ها به شما امکان می‌دهند تا داده‌های کاربر را بین صفحات وب نگه دارید. این ابزار برای مدیریت اطلاعات ورود کاربران و ذخیره داده‌های موقت استفاده می‌شود.

#### **10.5.1 شروع و استفاده از نشست‌ها**

نشست‌ها با استفاده از تابع `session_start()` شروع می‌شوند و می‌توان داده‌ها را در آرایه فوق‌العاده `$_SESSION` ذخیره کرد.

**مثال: مدیریت نشست‌ها در PHP:**

```php
<?php
session_start(); // شروع نشست

// ذخیره اطلاعات در نشست
$_SESSION['username'] = 'JohnDoe';

// دسترسی به داده‌های نشست
echo "Welcome, " . $_SESSION['username'];

// بستن نشست
session_destroy();
?>
```

#### **10.5.2 کنترل دسترسی با استفاده از نشست‌ها**

می‌توان از نشست‌ها برای کنترل دسترسی به صفحات خاص بر اساس وضعیت ورود کاربران استفاده کرد.

**مثال: بررسی ورود کاربر:**

```php
<?php
session_start();
if (!isset($_SESSION['username'])) {
    header('Location: login.php'); // هدایت به صفحه ورود
    exit();
}
?>
```

### **10.6 استفاده از کوکی‌ها (Cookies) در PHP**

کوکی‌ها به شما اجازه می‌دهند تا داده‌ها را در سمت کلاینت (مرورگر) ذخیره کنید و آن‌ها را بین درخواست‌های مختلف استفاده کنید.

#### **10.6.1 تنظیم و دریافت کوکی‌ها**

برای تنظیم یک کوکی از تابع `setcookie()` استفاده می‌شود و برای دسترسی به آن از آرایه فوق‌العاده `$_COOKIE`.

**مثال: تنظیم و دسترسی به کوکی‌ها:**

```php
<?php
// تنظیم کوکی برای مدت یک ساعت
setcookie("user", "JohnDoe", time() + 3600, "/"); // 3600 = 1 ساعت

if (isset($_COOKIE['user'])) {
    echo "Welcome back, " . $_COOKIE['user'];
} else {
    echo "Welcome, guest!";
}
?>
```

#### **10.6.2 حذف کوکی‌ها**

برای حذف یک کوکی، باید زمان انقضای آن را به گذشته تنظیم کرد.

**مثال: حذف کوکی:**

```php
<?php
setcookie("user", "", time() - 3600, "/"); // حذف کوکی با تنظیم زمان منقضی به گذشته
?>
```

### **10.7 امنیت در کار با فرم‌ها**

امنیت در کار با فرم‌ها و داده‌های کاربر یکی از مهم‌ترین مباحث است. برخی از نکات کلیدی برای افزایش امنیت عبارتند از:

1. **جلوگیری از XSS (Cross-Site Scripting):** همیشه داده‌های ورودی کاربر را با استفاده از توابعی مانند `htmlspecialchars()` پاکسازی کنید.
   
2. **جلوگیری از SQL Injection:** استفاده از دستورات آماده (Prepared Statements) و PDO برای جلوگیری از دستورات SQL مخرب.
   
3. **استفاده از توکن‌های CSRF (Cross-Site Request Forgery):** اضافه کردن توکن‌های CSRF به فرم‌ها برای جلوگیری از حملات CSRF.

**مثال: استفاده از توکن‌های CSRF:**

```php
<?php
session_start();
if (empty($_SESSION['csrf_token'])) {
    $_SESSION['csrf_token'] = bin2hex(random_bytes(32)); // ایجاد توکن CSRF
}

if ($_SERVER['REQUEST_METHOD'] === 'POST') {


    if (!hash_equals($_SESSION['csrf_token'], $_POST['csrf_token'])) {
        die('Invalid CSRF token');
    }
}

// استفاده از توکن در فرم
echo '<input type="hidden" name="csrf_token" value="' . $_SESSION['csrf_token'] . '">';
?>
```

### **10.8 تمرین‌های فصل دهم**

1. **ایجاد فرم ورود و ثبت‌نام:** دو فرم ایجاد کنید، یکی برای ورود و دیگری برای ثبت‌نام کاربران. داده‌ها را به صورت امن پردازش کرده و در پایگاه داده ذخیره کنید.
   
2. **اعتبارسنجی داده‌های ورودی:** فرم ثبت‌نامی ایجاد کنید که اطلاعات کاربر را دریافت کرده و قبل از ذخیره‌سازی، همه داده‌ها را اعتبارسنجی کند.
   
3. **استفاده از نشست‌ها برای مدیریت ورود:** برنامه‌ای بنویسید که نشست‌ها را برای مدیریت وضعیت ورود کاربران استفاده کند.
   
4. **ایجاد سیستم کوکی برای حفظ داده‌ها:** سیستمی ایجاد کنید که اطلاعات کاربر را با استفاده از کوکی‌ها حفظ کند و آن‌ها را برای بازدید بعدی بازیابی کند.
   
5. **محافظت از فرم‌ها با توکن CSRF:** سیستمی ایجاد کنید که توکن‌های CSRF را به فرم‌ها اضافه کرده و آن‌ها را در سرور اعتبارسنجی کند.

### **خلاصه فصل دهم**

در این فصل، با نحوه تعامل PHP با فرم‌ها و وب آشنا شدید. نحوه ایجاد فرم‌های HTML، دریافت و پردازش داده‌های فرم با استفاده از متدهای `GET` و `POST`، اعتبارسنجی داده‌ها، مدیریت نشست‌ها و کوکی‌ها، و بهترین شیوه‌های امنیتی برای جلوگیری از حملات مختلف توضیح داده شدند. این مباحث به شما کمک می‌کنند تا برنامه‌های وب ایمن‌تر و قابل اعتمادتری با PHP بسازید.

---

</div>